import * as babel from "@babel/core";
const validAstroGlobalNames = new Set(["Astro", "Astro2"]);
function astro({ config, devServer }) {
  return {
    name: "@astrojs/vite-plugin-astro-postprocess",
    async transform(code, id) {
      if (!id.endsWith(".astro") && !id.endsWith(".md")) {
        return null;
      }
      if (!code.includes("fetchContent")) {
        return null;
      }
      const result = await babel.transformAsync(code, {
        sourceType: "module",
        sourceMaps: true,
        plugins: [
          () => {
            return {
              visitor: {
                StringLiteral(path) {
                  if (path.parent.type !== "CallExpression" || path.parent.callee.type !== "MemberExpression" || !validAstroGlobalNames.has(path.parent.callee.object.name) || path.parent.callee.property.name !== "fetchContent") {
                    return;
                  }
                  const { value } = path.node;
                  if (/[a-z]\:\/\//.test(value)) {
                    return;
                  }
                  path.replaceWith({
                    type: "CallExpression",
                    callee: {
                      type: "MemberExpression",
                      object: { type: "MetaProperty", meta: { type: "Identifier", name: "import" }, property: { type: "Identifier", name: "meta" } },
                      property: { type: "Identifier", name: "globEager" },
                      computed: false
                    },
                    arguments: [path.node]
                  });
                }
              }
            };
          }
        ]
      });
      if (!result || !result.code) {
        return null;
      }
      return { code: result.code, map: result.map };
    }
  };
}
export {
  astro as default
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vc3JjL3ZpdGUtcGx1Z2luLWFzdHJvLXBvc3Rwcm9jZXNzL2luZGV4LnRzIl0sCiAgIm1hcHBpbmdzIjogIkFBTUE7QUFRQSxNQUFNLHdCQUF3QixJQUFJLElBQUksQ0FBQyxTQUFTO0FBRWpDLGVBQWUsRUFBRSxRQUFRLGFBQXlDO0FBQ2hGLFNBQU87QUFBQSxJQUNOLE1BQU07QUFBQSxVQUNBLFVBQVUsTUFBTSxJQUFJO0FBRXpCLFVBQUksQ0FBQyxHQUFHLFNBQVMsYUFBYSxDQUFDLEdBQUcsU0FBUyxRQUFRO0FBQ2xELGVBQU87QUFBQTtBQUtSLFVBQUksQ0FBQyxLQUFLLFNBQVMsaUJBQWlCO0FBQ25DLGVBQU87QUFBQTtBQUlSLFlBQU0sU0FBUyxNQUFNLE1BQU0sZUFBZSxNQUFNO0FBQUEsUUFDL0MsWUFBWTtBQUFBLFFBQ1osWUFBWTtBQUFBLFFBQ1osU0FBUztBQUFBLFVBQ1IsTUFBTTtBQUNMLG1CQUFPO0FBQUEsY0FDTixTQUFTO0FBQUEsZ0JBQ1IsY0FBYyxNQUErQztBQUM1RCxzQkFDQyxLQUFLLE9BQU8sU0FBUyxvQkFDckIsS0FBSyxPQUFPLE9BQU8sU0FBUyxzQkFDNUIsQ0FBQyxzQkFBc0IsSUFBSyxLQUFLLE9BQU8sT0FBTyxPQUFlLFNBQzdELEtBQUssT0FBTyxPQUFPLFNBQWlCLFNBQVMsZ0JBQzdDO0FBQ0Q7QUFBQTtBQUVELHdCQUFNLEVBQUUsVUFBVSxLQUFLO0FBQ3ZCLHNCQUFJLGNBQWMsS0FBSyxRQUFRO0FBQzlCO0FBQUE7QUFFRCx1QkFBSyxZQUFZO0FBQUEsb0JBQ2hCLE1BQU07QUFBQSxvQkFDTixRQUFRO0FBQUEsc0JBQ1AsTUFBTTtBQUFBLHNCQUNOLFFBQVEsRUFBRSxNQUFNLGdCQUFnQixNQUFNLEVBQUUsTUFBTSxjQUFjLE1BQU0sWUFBWSxVQUFVLEVBQUUsTUFBTSxjQUFjLE1BQU07QUFBQSxzQkFDcEgsVUFBVSxFQUFFLE1BQU0sY0FBYyxNQUFNO0FBQUEsc0JBQ3RDLFVBQVU7QUFBQTtBQUFBLG9CQUVYLFdBQVcsQ0FBQyxLQUFLO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFVeEIsVUFBSSxDQUFDLFVBQVUsQ0FBQyxPQUFPLE1BQU07QUFDNUIsZUFBTztBQUFBO0FBR1IsYUFBTyxFQUFFLE1BQU0sT0FBTyxNQUFNLEtBQUssT0FBTztBQUFBO0FBQUE7QUFBQTsiLAogICJuYW1lcyI6IFtdCn0K
